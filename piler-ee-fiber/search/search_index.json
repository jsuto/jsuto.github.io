{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Piler enterprise 2.x documentation","text":""},{"location":"#generic-notes","title":"Generic notes","text":"<p>GDPR related notes</p> <p>Piler Verfahrensdokumentation Enterprise Edition</p>"},{"location":"#new-features","title":"New features","text":"<p>New features in 2.0.0</p>"},{"location":"#for-end-users","title":"For end users","text":"<p>User guide to the UI</p>"},{"location":"#for-administrators","title":"For administrators","text":"<p>Overview</p> <p>Email archive sizing calculator</p> <p>Release notes</p> <p>Upgrading piler enterprise</p> <p>Installing piler enterprise edition</p> <p>Tuning the archive</p> <p>Benchmarking the archive</p> <p>UI config options</p> <p>Using S3 compatible storage</p> <p>Securing the archive</p> <p>REST API</p> <p>Azure AD/Entra SSO login</p> <p>Google Workspace SSO login</p>"},{"location":"azure-ad-auth/","title":"Authenticating against Azure AD/Entra","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-26</p> <p>Azure is a popular cloud provider, and the piler UI supports Azure AD/Entra to provide Single Sign-On (SSO).</p>"},{"location":"azure-ad-auth/#prerequisites","title":"Prerequisites","text":"<p>You have an Azure subscription or trial, you have created users and preferably groups in the appropriate Azure tenant.</p>"},{"location":"azure-ad-auth/#setup-the-application-in-azure","title":"Setup the application in Azure","text":"<p>Click on \u201cApp registration\u201c, enter a name for the application, select \u201cAny Azure AD directory \u2013 Multitenant\u201d at the supported account types, and set the \u201cRedirect URI\u201c. Be sure to replace \u201carchive.example.com\u201d with your archive FQDN. Finally record the application (client) id value.</p> <p></p> <p>Click \u201cCertificates and secrets\u201d, create a new client secret, and record the secret value.</p> <p></p> <p>Select \u201cAPI permissions\u201d, and add the following permissions, then click on the \u201cGrant Admin consent for \u2026\u201d button</p> <p></p>"},{"location":"azure-ad-auth/#configure-the-piler-ui-to-allow-azure-ad-authentication","title":"Configure the piler UI to allow Azure AD authentication","text":"<p>Add the following to the .env file (or to the settings json if you have a multi-tenant license: Be sure to use your actual IDs and secret values!</p> <pre><code>ENABLE_AZURE_AUTH=true\nAZURE_REDIRECT_URL=https://archive.example.com/auth/azure/callback\nAZURE_CLIENT_SECRET=xxxxx~yyyyy_hhhhhhhhhhh.jjjjjjjjjjjjjjjj\nAZURE_CLIENT_ID=aaaaaaaaa-bbbbbb-ccccc-dddddd-eeeeeeeeeeee\nAZURE_TENANT_ID=xxxxxxx-yyyyyyy-zzzzzzzzz-tttttttttt\n</code></pre>"},{"location":"azure-ad-auth/#let-the-users-log-in","title":"Let the users log in","text":"<p>Users will see the \u201cAzure AD\u201d link on the login screen.</p> <p></p> <p>After clicking on it the user is redirected to Azure for authentication. After providing his credentials, he\u2019s redirected back to the piler UI.</p> <p></p> <p>The user also has his group assignments from Azure, and the local groups if there are any.</p> <p></p>"},{"location":"benchmarks/","title":"Benchmarking the new fiber UI","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-26</p> <p>Piler enterprise has a new web app backend. While the 1.x series relies on nginx+PHP, the 2.x series has been rewritten using Go Fiber. While the look of the UI is the same, the backend offers a much better performance.</p>"},{"location":"benchmarks/#benchmark-comparison","title":"Benchmark comparison","text":"<p>The below numbers apply to a virtual machine (VM) having 2 vCPUs and 2 GB memory. Both the fiber and the nginx+php combo have been hit by the k6 performance testing tool using 50 virtual users (VU) for 30s.</p> <p>The search test used an array of 5 search expressions. The view test used an array of 5 messages ranging from 6 kB to 300 kB. Also the search test included a 0.001s delay between requests.</p>"},{"location":"benchmarks/#the-results","title":"The results","text":"Type fiber nginx+php Search 28-29k 9.2k View 18k 1.7k <p>The results indicate that the fiber UI outperforms the legacy UI by a factor of 3 when searching, and by a factor of 10 when retrieving emails from the storage.</p>"},{"location":"benchmarks/#why-nginxphp-fpm-tops-out-earlier","title":"Why nginx/php-fpm tops out earlier","text":"<p>Context switching: PHP-FPM spawns pools of workers, each a separate process. Even with tuning, there\u2019s higher scheduling overhead compared to Fiber goroutines.</p> <p>IPC overhead: Every request goes through nginx \u2192 fastcgi interface \u2192 PHP-FPM socket. Fiber skips this layer.</p> <p>Memory pressure: With 2 GB RAM, each PHP-FPM worker might use 20\u201350 MB under load. 50 workers could eat most of your RAM, so pm.max_children can\u2019t be raised too high.</p> <p>PHP runtime cost: Each request must bootstrap PHP, autoload, parse code paths, etc. Fiber just dispatches Go handlers in memory.</p> <p>The throughput ceiling is in the PHP code execution itself (runtime overhead + DB roundtrips).</p> <p>That\u2019s why Fiber is already giving you a 3\u00d7 boost with the same DB backend and hardware.</p>"},{"location":"fiber-ui-config-options/","title":"UI configuration options","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-09</p>"},{"location":"fiber-ui-config-options/#piler_key","title":"PILER_KEY","text":"<p>Default value: <code>/etc/piler/piler.key</code></p> <p>Description: Path to the private key file used by Piler for signing and cryptographic operations.</p>"},{"location":"fiber-ui-config-options/#retriever_method","title":"RETRIEVER_METHOD","text":"<p>Default value: <code>direct</code></p> <p>Description: Defines how archived emails are retrieved. Options:</p> <ul> <li><code>direct</code>: Read directly from storage</li> <li><code>socket</code>: Use a UNIX domain socket connection</li> <li><code>s3</code>: Retrieve from Amazon S3 or compatible storage</li> </ul>"},{"location":"fiber-ui-config-options/#log_level","title":"LOG_LEVEL","text":"<p>Default value: <code>INFO</code></p> <p>Description: Sets the logging verbosity level. Possible values: <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>.</p>"},{"location":"fiber-ui-config-options/#log_format","title":"LOG_FORMAT","text":"<p>Default value: <code>json</code></p> <p>Description: Output format of logs. Options: <code>json</code>, <code>plain</code>.</p>"},{"location":"fiber-ui-config-options/#username","title":"USERNAME","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Username for the UI to run when started as root.</p>"},{"location":"fiber-ui-config-options/#license_file","title":"LICENSE_FILE","text":"<p>Default value: <code>./license.jwt</code></p> <p>Description: Path to the license file containing a signed license token.</p>"},{"location":"fiber-ui-config-options/#listen_addr","title":"LISTEN_ADDR","text":"<p>Default value: <code>:3000</code></p> <p>Description: Address and port where the Fiber web application will listen for HTTP requests.</p>"},{"location":"fiber-ui-config-options/#trusted_proxies","title":"TRUSTED_PROXIES","text":"<p>Default value: <code>127.0.0.1</code></p> <p>Description: Comma-separated list of trusted proxy IP addresses for handling forwarded headers.</p>"},{"location":"fiber-ui-config-options/#proxy_header","title":"PROXY_HEADER","text":"<p>Default value: <code>X-Forwarded-For</code></p> <p>Description: HTTP header used to extract the real client IP address when behind a proxy.</p>"},{"location":"fiber-ui-config-options/#retriever_socket","title":"RETRIEVER_SOCKET","text":"<p>Default value: <code>/var/piler/sockets/retriever.sock</code></p> <p>Description: Path to the UNIX domain socket used when <code>RETRIEVER_METHOD=socket</code>.</p>"},{"location":"fiber-ui-config-options/#mysql_user","title":"MYSQL_USER","text":"<p>Default value: <code>piler</code></p> <p>Description: MySQL database username.</p>"},{"location":"fiber-ui-config-options/#mysql_password","title":"MYSQL_PASSWORD","text":"<p>Default value: <code>piler123</code></p> <p>Description: MySQL database password.</p>"},{"location":"fiber-ui-config-options/#mysql_host","title":"MYSQL_HOST","text":"<p>Default value: <code>localhost:3306</code></p> <p>Description: Host and port of the MySQL server.</p>"},{"location":"fiber-ui-config-options/#mysql_max_open_conn","title":"MYSQL_MAX_OPEN_CONN","text":"<p>Default value: <code>50</code></p> <p>Description: Maximum number of open MySQL connections per child process.</p>"},{"location":"fiber-ui-config-options/#mysql_max_idle_conn","title":"MYSQL_MAX_IDLE_CONN","text":"<p>Default value: <code>20</code></p> <p>Description: Maximum number of idle MySQL connections in the connection pool.</p>"},{"location":"fiber-ui-config-options/#mysql_conn_max_lifetime","title":"MYSQL_CONN_MAX_LIFETIME","text":"<p>Default value: <code>300s</code></p> <p>Description: Maximum lifetime of a MySQL connection before it is recycled.</p>"},{"location":"fiber-ui-config-options/#manticore_dsn","title":"MANTICORE_DSN","text":"<p>Default value: <code>piler:piler123@tcp(localhost:9306)/?parseTime=true</code></p> <p>Description: DSN for connecting to Manticore search engine (read/write).</p>"},{"location":"fiber-ui-config-options/#manticore_readonly_dsn","title":"MANTICORE_READONLY_DSN","text":"<p>Default value: <code>piler:piler123@tcp(localhost:9307)/?parseTime=true</code></p> <p>Description: DSN for connecting to Manticore search engine (read-only).</p>"},{"location":"fiber-ui-config-options/#redis_addr","title":"REDIS_ADDR","text":"<p>Default value: <code>127.0.0.1:6379</code></p> <p>Description: Redis server address.</p>"},{"location":"fiber-ui-config-options/#tenant_rate_limit_per_minute","title":"TENANT_RATE_LIMIT_PER_MINUTE","text":"<p>Default value: <code>20000</code></p> <p>Description: Maximum number of requests allowed per tenant per minute.</p>"},{"location":"fiber-ui-config-options/#io_rate_limit_per_route","title":"IO_RATE_LIMIT_PER_ROUTE","text":"<p>Default value: <code>200</code></p> <p>Description: I/O rate limit for routes that retrieves emails or attachments from the storage, eg. view, download, attachments (requests per second).</p>"},{"location":"fiber-ui-config-options/#dev_mode","title":"DEV_MODE","text":"<p>Default value: <code>false</code></p> <p>Description: Enables development mode with relaxed security and verbose logging.</p>"},{"location":"fiber-ui-config-options/#node_type","title":"NODE_TYPE","text":"<p>Default value: <code>master</code></p> <p>Description: Role of the current node in a multi-node setup. Options: <code>master</code>, <code>worker</code>.</p>"},{"location":"fiber-ui-config-options/#workers","title":"WORKERS","text":"<p>Default value: <code>\"\"</code></p> <p>Description: List of worker node addresses (for multi-node setups).</p>"},{"location":"fiber-ui-config-options/#jwt_secret","title":"JWT_SECRET","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Secret key used to sign JWT tokens.</p>"},{"location":"fiber-ui-config-options/#enable_category","title":"ENABLE_CATEGORY","text":"<p>Default value: <code>true</code></p> <p>Description: Enable or disable category handling in the UI.</p>"},{"location":"fiber-ui-config-options/#enable_redact","title":"ENABLE_REDACT","text":"<p>Default value: <code>true</code></p> <p>Description: Enable or disable text redaction in the UI.</p>"},{"location":"fiber-ui-config-options/#languages","title":"LANGUAGES","text":"<p>Default value: <code>de,en,es,fr,zh</code></p> <p>Description: List of supported UI languages.</p>"},{"location":"fiber-ui-config-options/#locale","title":"LOCALE","text":"<p>Default value: <code>en-US</code></p> <p>Description: Default locale used for formatting dates and text.</p>"},{"location":"fiber-ui-config-options/#login_logo","title":"LOGIN_LOGO","text":"<p>Default value: <code>/assets/images/login-logo.svg</code></p> <p>Description: Path to the logo displayed on the login page.</p>"},{"location":"fiber-ui-config-options/#header_logo","title":"HEADER_LOGO","text":"<p>Default value: <code>/assets/images/logo-header.svg</code></p> <p>Description: Path to the logo displayed in the application header.</p>"},{"location":"fiber-ui-config-options/#toast_logo","title":"TOAST_LOGO","text":"<p>Default value: <code>/assets/images/logo-round.svg</code></p> <p>Description: Path to the logo used in toast notifications.</p>"},{"location":"fiber-ui-config-options/#header_link","title":"HEADER_LINK","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Custom link displayed in the application header.</p>"},{"location":"fiber-ui-config-options/#header_link_title","title":"HEADER_LINK_TITLE","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Title text for the header link.</p>"},{"location":"fiber-ui-config-options/#max_content_length_to_display","title":"MAX_CONTENT_LENGTH_TO_DISPLAY","text":"<p>Default value: <code>30000</code></p> <p>Description: Maximum content size (in bytes) to render in the UI. Longer messages are truncated in the message preview, but other than that the message is still intact.</p>"},{"location":"fiber-ui-config-options/#rt_index","title":"RT_INDEX","text":"<p>Default value: <code>true</code></p> <p>Description: Enable or disable real-time indexing.</p>"},{"location":"fiber-ui-config-options/#extra_notes","title":"EXTRA_NOTES","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Custom notes displayed in the login page.</p>"},{"location":"fiber-ui-config-options/#multitenancy","title":"MULTITENANCY","text":"<p>Default value: <code>false</code></p> <p>Description: Enable or disable multi-tenant mode.</p>"},{"location":"fiber-ui-config-options/#multinodes","title":"MULTINODES","text":"<p>Default value: <code>false</code></p> <p>Description: Enable or disable multi-node mode.</p>"},{"location":"fiber-ui-config-options/#css","title":"CSS","text":"<p>Default value:  </p> <pre><code>&lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" integrity=\"sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\" crossorigin=\"anonymous\"&gt; \n&lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css\"&gt; \n&lt;link rel=\"stylesheet\" href=\"/assets/css/style.css\"&gt;\n</code></pre> <p>Description: Built-in CSS includes for styling the UI.</p>"},{"location":"fiber-ui-config-options/#custom_css","title":"CUSTOM_CSS","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Custom CSS overrides for the UI.</p>"},{"location":"fiber-ui-config-options/#admin_group","title":"ADMIN_GROUP","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP or SSO group mapped to administrators.</p>"},{"location":"fiber-ui-config-options/#auditor_group","title":"AUDITOR_GROUP","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP or SSO group mapped to auditors.</p>"},{"location":"fiber-ui-config-options/#restricted_auditor_group","title":"RESTRICTED_AUDITOR_GROUP","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP or SSO group mapped to restricted auditors.</p>"},{"location":"fiber-ui-config-options/#dataofficer_group","title":"DATAOFFICER_GROUP","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP or SSO group mapped to data officers.</p>"},{"location":"fiber-ui-config-options/#enable_google_auth","title":"ENABLE_GOOGLE_AUTH","text":"<p>Default value: <code>false</code></p> <p>Description: Enable Google OAuth2 authentication.</p>"},{"location":"fiber-ui-config-options/#google_client_id","title":"GOOGLE_CLIENT_ID","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Google OAuth2 client ID.</p>"},{"location":"fiber-ui-config-options/#google_client_secret","title":"GOOGLE_CLIENT_SECRET","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Google OAuth2 client secret.</p>"},{"location":"fiber-ui-config-options/#google_redirect_url","title":"GOOGLE_REDIRECT_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Redirect URL for Google OAuth2 login.</p>"},{"location":"fiber-ui-config-options/#enable_azure_auth","title":"ENABLE_AZURE_AUTH","text":"<p>Default value: <code>false</code></p> <p>Description: Enable Microsoft Azure OAuth2 authentication.</p>"},{"location":"fiber-ui-config-options/#azure_client_id","title":"AZURE_CLIENT_ID","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Azure OAuth2 client ID.</p>"},{"location":"fiber-ui-config-options/#azure_client_secret","title":"AZURE_CLIENT_SECRET","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Azure OAuth2 client secret.</p>"},{"location":"fiber-ui-config-options/#azure_tenant_id","title":"AZURE_TENANT_ID","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Azure Active Directory tenant ID.</p>"},{"location":"fiber-ui-config-options/#azure_redirect_url","title":"AZURE_REDIRECT_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Redirect URL for Azure OAuth2 login.</p>"},{"location":"fiber-ui-config-options/#enable_generic_oauth_auth","title":"ENABLE_GENERIC_OAUTH_AUTH","text":"<p>Default value: <code>false</code></p> <p>Description: Enable generic OAuth2 authentication.</p>"},{"location":"fiber-ui-config-options/#generic_oauth_client_id","title":"GENERIC_OAUTH_CLIENT_ID","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Client ID for generic OAuth2 provider.</p>"},{"location":"fiber-ui-config-options/#generic_oauth_client_secret","title":"GENERIC_OAUTH_CLIENT_SECRET","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Client secret for generic OAuth2 provider.</p>"},{"location":"fiber-ui-config-options/#generic_oauth_redirect_url","title":"GENERIC_OAUTH_REDIRECT_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Redirect URL for generic OAuth2 login.</p>"},{"location":"fiber-ui-config-options/#generic_oauth_auth_url","title":"GENERIC_OAUTH_AUTH_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Authorization URL for generic OAuth2 provider.</p>"},{"location":"fiber-ui-config-options/#generic_oauth_token_url","title":"GENERIC_OAUTH_TOKEN_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Token URL for generic OAuth2 provider.</p>"},{"location":"fiber-ui-config-options/#generic_oauth_userinfo_url","title":"GENERIC_OAUTH_USERINFO_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: User info URL for generic OAuth2 provider.</p>"},{"location":"fiber-ui-config-options/#enable_authenticator","title":"ENABLE_AUTHENTICATOR","text":"<p>Default value: <code>true</code></p> <p>Description: Enable TOTP authenticator usage for 2FA.</p>"},{"location":"fiber-ui-config-options/#date_format","title":"DATE_FORMAT","text":"<p>Default value: <code>YYYY/MM/DD</code></p> <p>Description: Default date format used in the UI.</p>"},{"location":"fiber-ui-config-options/#timezone","title":"TIMEZONE","text":"<p>Default value: <code>Europe/Budapest</code></p> <p>Description: Default timezone used by the application.</p>"},{"location":"fiber-ui-config-options/#max_download_messages","title":"MAX_DOWNLOAD_MESSAGES","text":"<p>Default value: <code>100</code></p> <p>Description: Maximum number of messages that can be downloaded at once.</p>"},{"location":"fiber-ui-config-options/#smarthost","title":"SMARTHOST","text":"<p>Default value: <code>\"\"</code></p> <p>Description: SMTP relay host (smarthost) used for restoring emails.</p>"},{"location":"fiber-ui-config-options/#smarthost_port","title":"SMARTHOST_PORT","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Port number for the smarthost.</p>"},{"location":"fiber-ui-config-options/#noreply_email_address","title":"NOREPLY_EMAIL_ADDRESS","text":"<p>Default value: <code>no-reply@archive.example.com</code></p> <p>Description: Default \"no-reply\" email address for the UI when restoring email messages.</p>"},{"location":"fiber-ui-config-options/#enable_ldap_auth","title":"ENABLE_LDAP_AUTH","text":"<p>Default value: <code>false</code></p> <p>Description: Enable LDAP authentication.</p>"},{"location":"fiber-ui-config-options/#ldap_host","title":"LDAP_HOST","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP server host and port.</p>"},{"location":"fiber-ui-config-options/#ldap_base_dn","title":"LDAP_BASE_DN","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Base DN for LDAP searches.</p>"},{"location":"fiber-ui-config-options/#ldap_bind_dn","title":"LDAP_BIND_DN","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Bind DN used for LDAP authentication.</p>"},{"location":"fiber-ui-config-options/#ldap_bind_password","title":"LDAP_BIND_PASSWORD","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Password for LDAP bind DN.</p>"},{"location":"fiber-ui-config-options/#ldap_account_objectclass","title":"LDAP_ACCOUNT_OBJECTCLASS","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP object class for user accounts.</p>"},{"location":"fiber-ui-config-options/#ldap_account_mail_attr","title":"LDAP_ACCOUNT_MAIL_ATTR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP attribute for user email addresses.</p>"},{"location":"fiber-ui-config-options/#ldap_account_userid_attr","title":"LDAP_ACCOUNT_USERID_ATTR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP attribute for user ID.</p>"},{"location":"fiber-ui-config-options/#ldap_account_username_attr","title":"LDAP_ACCOUNT_USERNAME_ATTR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP attribute for username.</p>"},{"location":"fiber-ui-config-options/#ldap_distributionlist_objectclass","title":"LDAP_DISTRIBUTIONLIST_OBJECTCLASS","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP object class for distribution lists.</p>"},{"location":"fiber-ui-config-options/#ldap_distributionlist_mail_attr","title":"LDAP_DISTRIBUTIONLIST_MAIL_ATTR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: LDAP attribute for distribution list email addresses.</p>"},{"location":"fiber-ui-config-options/#enable_imap_auth","title":"ENABLE_IMAP_AUTH","text":"<p>Default value: <code>false</code></p> <p>Description: Enable IMAP authentication.</p>"},{"location":"fiber-ui-config-options/#restore_over_imap","title":"RESTORE_OVER_IMAP","text":"<p>Default value: <code>true</code></p> <p>Description: Allow restoring messages to user mailboxes over IMAP.</p>"},{"location":"fiber-ui-config-options/#imap_server","title":"IMAP_SERVER","text":"<p>Default value: <code>\"\"</code></p> <p>Description: IMAP server address.</p>"},{"location":"fiber-ui-config-options/#imap_folder","title":"IMAP_FOLDER","text":"<p>Default value: <code>INBOX</code></p> <p>Description: IMAP folder where restored emails are delivered.</p>"},{"location":"fiber-ui-config-options/#imap_use_tls","title":"IMAP_USE_TLS","text":"<p>Default value: <code>true</code></p> <p>Description: Use TLS for IMAP connections.</p>"},{"location":"fiber-ui-config-options/#enable_pop3_auth","title":"ENABLE_POP3_AUTH","text":"<p>Default value: <code>false</code></p> <p>Description: Enable POP3 authentication.</p>"},{"location":"fiber-ui-config-options/#pop3_server","title":"POP3_SERVER","text":"<p>Default value: <code>\"\"</code></p> <p>Description: POP3 server address.</p>"},{"location":"fiber-ui-config-options/#pop3_use_tls","title":"POP3_USE_TLS","text":"<p>Default value: <code>true</code></p> <p>Description: Use TLS for POP3 connections.</p>"},{"location":"fiber-ui-config-options/#mailcow_host","title":"MAILCOW_HOST","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Mailcow server address.</p>"},{"location":"fiber-ui-config-options/#mailcow_api_key","title":"MAILCOW_API_KEY","text":"<p>Default value: <code>\"\"</code></p> <p>Description: API key for Mailcow integration.</p>"},{"location":"fiber-ui-config-options/#caution_text","title":"CAUTION_TEXT","text":"<p>Default value: <code>Caution: This message was sent from outside the company.&lt;br /&gt;Please do not click links or open attachments unless you&lt;br /&gt;recognize the source of this email and know the content is safe!</code></p> <p>Description: Warning banner displayed on external messages.</p>"},{"location":"fiber-ui-config-options/#gotenberg_addr","title":"GOTENBERG_ADDR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Address of Gotenberg service used for document PDF export.</p>"},{"location":"fiber-ui-config-options/#enable_export","title":"ENABLE_EXPORT","text":"<p>Default value: <code>true</code></p> <p>Description: Enable export functionality for messages.</p>"},{"location":"fiber-ui-config-options/#min_size_to_enable_export","title":"MIN_SIZE_TO_ENABLE_EXPORT","text":"<p>Default value: <code>10000000000</code></p> <p>Description: Minimum storage size (bytes) required before export is enabled.</p>"},{"location":"fiber-ui-config-options/#max_export_messages","title":"MAX_EXPORT_MESSAGES","text":"<p>Default value: <code>20000</code></p> <p>Description: Maximum number of messages included in a single export.</p>"},{"location":"fiber-ui-config-options/#export_timeout","title":"EXPORT_TIMEOUT","text":"<p>Default value: <code>300s</code></p> <p>Description: Timeout duration for export jobs.</p>"},{"location":"fiber-ui-config-options/#admin_can_manage_exports","title":"ADMIN_CAN_MANAGE_EXPORTS","text":"<p>Default value: <code>true</code></p> <p>Description: Allow administrators to manage export jobs.</p>"},{"location":"fiber-ui-config-options/#dir_export","title":"DIR_EXPORT","text":"<p>Default value: <code>/var/piler/export</code></p> <p>Description: Directory where exported files are stored.</p>"},{"location":"fiber-ui-config-options/#export_warning_text","title":"EXPORT_WARNING_TEXT","text":"<p>Default value: <code>Exported files will be auto removed in 7 days. Please download them in their scheduled period</code></p> <p>Description: Warning text shown to users about export retention.</p>"},{"location":"fiber-ui-config-options/#enable_delete","title":"ENABLE_DELETE","text":"<p>Default value: <code>false</code></p> <p>Description: Enable delete functionality for messages.</p>"},{"location":"fiber-ui-config-options/#need_to_approve_delete","title":"NEED_TO_APPROVE_DELETE","text":"<p>Default value: <code>false</code></p> <p>Description: Require data officer approval before message deletion.</p>"},{"location":"fiber-ui-config-options/#app_trace_name","title":"APP_TRACE_NAME","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Application trace name (used for distributed tracing).</p>"},{"location":"fiber-ui-config-options/#trace_addr","title":"TRACE_ADDR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Trace collector address (e.g., OpenTelemetry backend).</p>"},{"location":"fiber-ui-config-options/#turnstile_site_key","title":"TURNSTILE_SITE_KEY","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Cloudflare Turnstile site key.</p>"},{"location":"fiber-ui-config-options/#turnstile_secret_key","title":"TURNSTILE_SECRET_KEY","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Cloudflare Turnstile secret key.</p>"},{"location":"fiber-ui-config-options/#tika_url","title":"TIKA_URL","text":"<p>Default value: <code>http://127.0.0.1:9998/tika</code></p> <p>Description: Apache Tika server endpoint for content extraction.</p>"},{"location":"fiber-ui-config-options/#header_line_to_hide","title":"HEADER_LINE_TO_HIDE","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Comma separated Email header lines (without the colon!) to hide in the UI.</p>"},{"location":"fiber-ui-config-options/#example-header_line_to_hidereceiveddelivered-to","title":"Example: HEADER_LINE_TO_HIDE=Received,Delivered-To","text":""},{"location":"fiber-ui-config-options/#saml_cert_file","title":"SAML_CERT_FILE","text":"<p>Default value: <code>saml.crt</code></p> <p>Description: Path to the SAML certificate file.</p>"},{"location":"fiber-ui-config-options/#saml_key_file","title":"SAML_KEY_FILE","text":"<p>Default value: <code>saml.key</code></p> <p>Description: Path to the SAML private key file.</p>"},{"location":"fiber-ui-config-options/#saml_metadata_url","title":"SAML_METADATA_URL","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Metadata URL for SAML IdP.</p>"},{"location":"fiber-ui-config-options/#tsa_public_key_file","title":"TSA_PUBLIC_KEY_FILE","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Path to public key used to verify timestamp authority signatures.</p>"},{"location":"fiber-ui-config-options/#jwt_rsa_public_keys_dir","title":"JWT_RSA_PUBLIC_KEYS_DIR","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Directory containing RSA public keys for JWT validation.</p>"},{"location":"fiber-ui-config-options/#content_security_policy","title":"CONTENT_SECURITY_POLICY","text":"<p>Default value:</p> <pre><code>default-src 'self'; script-src 'self' 'unsafe-eval' 'sha256-ZswfTY7H35rbv8WC7NXBoiC7WNu86vSzCDChNWwZZDM=' \n'sha256-Sc84R3QT4gTYLl5M2SIYCramZDi3OcEjJiog35/7ydU=' https://cdn.jsdelivr.net https://challenges.cloudflare.com ; \nstyle-src 'self' https://cdn.jsdelivr.net; img-src 'self' data: https://cdn.jsdelivr.net https://challenges.cloudflare.com; \nfont-src 'self' https://cdn.jsdelivr.net; frame-src https://challenges.cloudflare.com; connect-src 'self'; \nobject-src 'none'; base-uri 'none'; form-action 'self'; frame-ancestors 'none';\n</code></pre> <p>Description: Content Security Policy (CSP) header applied by the application.</p>"},{"location":"fiber-ui-config-options/#s3_endpoint","title":"S3_ENDPOINT","text":"<p>Default value: <code>\"\"</code></p> <p>Description: S3-compatible storage endpoint, eg. <code>s3.eu-central-003.backblazeb2.com</code></p>"},{"location":"fiber-ui-config-options/#s3_access_key","title":"S3_ACCESS_KEY","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Access key for S3 storage.</p>"},{"location":"fiber-ui-config-options/#s3_secret_key","title":"S3_SECRET_KEY","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Secret key for S3 storage.</p>"},{"location":"fiber-ui-config-options/#s3_use_ssl","title":"S3_USE_SSL","text":"<p>Default value: <code>true</code></p> <p>Description: Enable SSL/TLS for S3 connections.</p>"},{"location":"fiber-ui-config-options/#s3_region","title":"S3_REGION","text":"<p>Default value: <code>\"\"</code></p> <p>Description: S3 region name.</p>"},{"location":"fiber-ui-config-options/#s3_bucket_prefix","title":"S3_BUCKET_PREFIX","text":"<p>Default value: <code>\"\"</code></p> <p>Description: Prefix applied to S3 buckets.</p>"},{"location":"fiber-ui-config-options/#s3_use_subdirs","title":"S3_USE_SUBDIRS","text":"<p>Default value: <code>true</code></p> <p>Description: Store objects in subdirectories within the S3 bucket.</p>"},{"location":"fiber-ui-config-options/#demo_mode","title":"DEMO_MODE","text":"<p>Default value: <code>false</code></p> <p>Description: Enable demo mode with restricted functionality.</p>"},{"location":"fiber-ui-config-options/#allowed_cidrs","title":"ALLOWED_CIDRS","text":"<p>Default value: <code>127.0.0.0/8,172.18.0.0/16,172.19.0.0/16,172.20.0.0/16</code></p> <p>Description: Defines CIDR blocks allowed to access the <code>/metrics</code> and <code>/healthz</code> endpoints.</p>"},{"location":"google-workspace-auth/","title":"Authenticating against Google Workspace (formerly known as GSuite)","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-26</p> <p>Google Workspace is a widely used email platform. This documentation describes how to setup Single Sign-On (SSO).</p>"},{"location":"google-workspace-auth/#prerequisites","title":"Prerequisites","text":"<p>You have your own domain at Google Workspace.</p>"},{"location":"google-workspace-auth/#register-the-archive-as-a-web-application","title":"Register the archive as a web application","text":"<p>Go to https://console.developers.google.com/apis/credentials then click on \u201cCreate credentials\u201d, then select \u201cOAuth Client ID\u201d.</p> <p>Fill the required fields, then click on the \u201cCREATE\u201d button. see the image below. Make sure you use your own archive\u2019s hostname.</p> <p></p> <p>Then you\u2019ll see a popup window that \u201cOAuth client created\u201d. Record the client id and the client secret values.</p> <p></p> <pre><code>ENABLE_GOOGLE_AUTH=true\nGOOGLE_REDIRECT_URL=https://archive.example.com/auth/google/callback\nGOOGLE_CLIENT_ID=303962613204-xxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com\nGOOGLE_CLIENT_SECRET=GOCSPX-zzzzzzzzzz-yyyyyyyyyyyyyyyyyyyyy\n</code></pre>"},{"location":"google-workspace-auth/#configure-google-to-send-a-copy-of-each-received-email-to-piler","title":"Configure Google to send a copy of each received email to piler","text":"<p>Visit https://admin.google.com/AdminHome?hl=en#AppDetails:service=email then select \u201cAdvanced settings\u201d.</p> <p>Find the \u201cRouting\u201d section, hover over the \u201cReceiving routing\u201d item, then click \u201cConfigure\u201d.</p> <p>Give a name to the setting, eg. \u201cpiler-receiving-rule\u201d.</p> <p>Check the \u201cInbound\u201d, and \u201cInternal \u2013 receiving\u201d checkboxes under \u201c1. Email messages to affect\u201d.</p> <p>Check the \u201cAdd X-Gm-Original-To header\u201d option.</p> <p></p> <p>Right under the \u201cAlso deliver to\u201d option check \u201cAdd more recipients\u201d, select \u201cAdvanced\u201d, then check \u201cChange envelope recipient\u201d, and type the archiving email address at \u201cReplace recipient\u201d.</p> <p></p> <p>Click on \u201cSave\u201d, then on \u201cAdd setting\u201d.</p> <p>Do the same for \u201cSender routing\u201d, except select \u201cOutbound\u201d, and \u201cInternal \u2013 sending\u201d at \u201c1. Email messages to affect\u201d</p> <p>Finally click on the \u201cSave changes\u201d button.</p>"},{"location":"google-workspace-auth/#login-for-end-users","title":"Login for end users","text":"<p>Users should click on the \u201cGoogle Workspace\u201d link, then grant permission to the registered web application to read the user\u2019s settings.</p> <p></p> <p>If all goes well, then the user is redirected back to the archive and has access to his archived emails.</p> <p></p>"},{"location":"new-features-in-2.0.0/","title":"What's new in 2.0.0","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-26</p>"},{"location":"new-features-in-2.0.0/#better-ui-performance","title":"Better UI performance","text":"<p>Piler enterprise has a new web app backend. While the 1.x series relies on nginx+PHP, the 2.x series has been rewritten using Go Fiber. Though the look of the UI is the same, the backend offers a much better performance, see the benchmark comparison between fiber and the legacy nginx+php app.</p>"},{"location":"new-features-in-2.0.0/#jwt-token-authentication","title":"JWT token authentication","text":"<p>The REST API uses JWT tokens to authenticate the request.</p>"},{"location":"new-features-in-2.0.0/#support-for-external-authentiation","title":"Support for external authentiation","text":"<p>It's possible to use ED25519 signed JWT tokens to let an external application authenticate users, and grant them a user session in the piler UI.</p>"},{"location":"new-features-in-2.0.0/#audit-records-moved-to-manticore","title":"Audit records moved to Manticore","text":"<p>To offer better searchability, the audit records are written to a manticore table.</p>"},{"location":"new-features-in-2.0.0/#ui-license","title":"UI license","text":"<p>The UI requires a dedicated license file.</p>"},{"location":"new-features-in-2.0.0/#dot-env-style-configuration","title":"Dot-env style configuration","text":"<p>The fiber UI uses an .env file (similar to what node.js apps use) to set various parameters, see the UI config options page what config parameters are available.</p> <p>When having a multi-tenant deployment, the global values can be overridden by setting the per-tenant values in the piler database customer_settings table <code>settings_json</code> column, eg.</p> <pre><code>{\"HEADER_LINK_TITLE\":\"Example archive\", \"HEADER_LINK\":\"https://example.com\"}\n</code></pre>"},{"location":"overview/","title":"Overview of piler enterprise edition","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-21</p>"},{"location":"overview/#piler-architecture-overview","title":"Piler architecture overview","text":"<p>Piler is flexible enough to support several configurations and layouts. Use one of the following layouts matching your environment.</p>"},{"location":"overview/#single-node-layout","title":"Single node layout","text":"<p>Figure 1. Single node installation</p> <p>This is the simplest layout, when you have a single node running piler enterprise. It allows you to start small, and expand later as you grow.</p> <p>Piler receives the emails directly, and archives them. The Piler node also runs the UI. To restore the emails it uses the smtp smarthost to deliver emails to the users\u2019 mailboxes.</p>"},{"location":"overview/#multiple-nodes-layout","title":"Multiple nodes layout","text":"<p>Figure 2. Multiple nodes layout</p> <p>A typical installation contains the following nodes:</p> <p>MX server: receives emails from the mail server, and distributes them among the worker nodes based on your preferences</p> <p>Smarthost: receives emails to be restored from the UI node, and delivers them to mail server</p> <p>Worker nodes: run the Piler daemons and archive the received emails</p> <p>UI node: runs the Piler UI allowing users to view their emails</p>"},{"location":"overview/#archive-components","title":"Archive components","text":"<p>Figure 3. Components on the archive host</p> <p>Piler enterprise features the following components:</p> <ul> <li>piler binaries and daemons: archiving emails</li> <li>web appp: display the UI the REST API</li> <li>mysql: store crucial metadata</li> <li>manticore: search index and audit logs</li> <li>redis/valkey cache: store user sessions and other user data</li> <li>reverse proxy, eg. traefik, nginx: provide https entrypoint</li> </ul>"},{"location":"overview/#platform-requirements","title":"Platform requirements","text":"<p>Supported platforms:</p> <ul> <li>Ubuntu 24.04 LTS (Noble)</li> <li>Centos 10</li> <li>Docker compose (on any Linux ditro)</li> </ul> <p>Note that piler supports both x64 and arm64 platforms.</p>"},{"location":"overview/#hardware-requirements","title":"Hardware requirements","text":"<p>Piler can be installed on physical hardware, virtual machine (VMware, etc), in the cloud (AWS, etc) or in a Docker container. Piler requires:</p> <ul> <li>2+ GB memory</li> <li>2+ (v)CPU</li> <li>200+ GB disk space</li> </ul> <p>Note that piler stores data in /var/piler/store and /var/piler/astore directories. Expect to have several millions of files in various size ranging from few kB to several MB.</p> <p>See the email archive sizing calculator for more</p> <p>Piler also supports S3 compatible object stores, see section S3 object store for more details.</p>"},{"location":"s3-storage/","title":"Using S3 object store","text":"<p>By default piler stores email files on the local filesystem under /var/piler subdirectories, thus requiring lots of disk space.</p> <p>Piler is able to store files on S3 compatible object stores, eg. Amazon S3, Wasabi, Exoscale, etc. Or you can even set up your own S3 object store with 3rd party software like Minio. Note that you should decide where to store the email files before starting archiving. Piler doesn\u2019t support a mixed mode where some emails are stored locally, and some emails on an S3 object store.</p> <p>When using S3 storage the piler daemon writes all files to /var/piler/s3 directory. Then a piler service processes these files, and upload them to the S3 store.</p> <p>Piler will upload all files for a given tenant to a single bucket only.</p>"},{"location":"s3-storage/#enable-the-s3-storage","title":"Enable the S3 storage","text":"<p>To enable using an S3 store, set the following in /etc/piler/piler.conf:</p> <pre><code>s3_hostname=your-s3-host.domain.com:9000\ns3_region=us-east-1\ns3_access_key=youraccesskey\ns3_secret_key=yoursecretkey\ns3_bucket_prefix=\ns3_dir=/var/piler/s3\ns3_use_subdirs=1\ns3_threads=10\ns3_secure=1\n</code></pre> <p>s3_hostname should be the S3 hostname and port. Eg. Minio uses port 9000. For Wasabi, it might be s3.us-west-1.wasabisys.com.</p> <p>Set <code>s3_secure=0</code> if your S3 host does NOT support TLS.</p> <p>By default s3_bucket_prefix is empty. If you need to specify one, then make sure it conforms to domain names.</p> <p>Notes: you must NOT use the dash (-) character, however you may use a trailing dot, eg.</p> <pre><code>s3_bucket_prefix=someprefix.\n</code></pre> <p>S3 settings for oracle cloud:</p> <pre><code>s3_access_key=youraccesskey\ns3_bucket_prefix=\ns3_dir=/var/piler/s3\ns3_hostname=frnsjgsfvvgl.compat.objectstorage.eu-frankfurt-1.oraclecloud.com\ns3_region=eu-frankfurt-1\ns3_secret_key=yoursecretkey\ns3_secure=1\ns3_threads=10\ns3_use_subdirs=1\n</code></pre> <p>S3 settings for Cloudflare bucket using EU jurisdiction:</p> <pre><code>s3_access_key=xxxxxxxxxxxxxxxxxx\ns3_bucket_prefix=\ns3_dir=/var/piler/s3\ns3_hostname=zzzzzzzzzzzzzzzzz.eu.r2.cloudflarestorage.com\ns3_region=auto\ns3_secret_key=yyyyyyyyyyyyyyyyyyyyyyyyyyyyy\ns3_secure=1\ns3_threads=10\ns3_use_subdirs=1\n</code></pre> <p>S3 settings for Backblaze bucket using EU-central:</p> <p>(Note: Backblaze doesn't accept dot (.) in the bucket name!)</p> <pre><code>s3_access_key=xxxxxxxxxxxxxxxxxx\ns3_bucket_prefix=\ns3_dir=/var/piler/s3\ns3_hostname=s3.eu-central-003.backblazeb2.com\ns3_region=us-east-1\ns3_secret_key=yyyyyyyyyyyyyyyyyyyyyyyyyyyyy\ns3_secure=1\ns3_threads=10\ns3_use_subdirs=1\n</code></pre> <p>S3 settings for Hetzner object store at fsn1 location:</p> <pre><code>s3_access_key=xxxxxxxxxxxxxxxxxx\ns3_bucket_prefix=\ns3_dir=/var/piler/s3\ns3_hostname=&lt;your hetzner id&gt;.fsn1.your-objectstorage.com\ns3_region=us-east-1\ns3_secret_key=yyyyyyyyyyyyyyyyyyyyyyyyyyyyy\ns3_secure=1\ns3_threads=10\ns3_use_subdirs=1\n</code></pre>"},{"location":"s3-storage/#update-the-ui-config","title":"Update the UI config","text":"<p>Put the S3 configuration to the UI env file as well. This is for a minio installation on port 9000 with no TLS configured:</p> <pre><code>RETRIEVER_METHOD=s3\nS3_ENDPOINT=minio:9000\nS3_ACCESS_KEY=root\nS3_SECRET_KEY=example156\nS3_USE_SSL=false\nS3_REGION=us-east-1\n</code></pre>"},{"location":"s3-storage/#enable-the-the-piler-s3-service","title":"Enable the the piler-s3 service","text":"<pre><code>cd /etc/systemd/system\nln -sf /usr/libexec/piler/piler-s3.service .\nsystemctl daemon-reload\nsystemctl enable piler-s3\nsystemctl start piler-s3\n</code></pre>"},{"location":"s3-storage/#s3-statistics","title":"S3 statistics","text":"<p>To allow S3 statistics you need to install the minio client:</p> <pre><code>curl -o /usr/local/bin/mc https://dl.min.io/client/mc/release/linux-amd64/mc\nchmod +x /usr/local/bin/mc\n</code></pre> <p>Then create a config file for minio:</p> <pre><code>su - piler\nmkdir -p /var/piler/.mc/\n</code></pre> <p>Create /var/piler/.mc/config.json. In the below example we used the following parameters (be sure to use your own settings):</p> <pre><code>s3_hostname=https://zzzzzzzzzzzzzzzzz.eu.r2.cloudflarestorage.com\ns3_access_key=aabbaabbaabb\ns3_secret_key=deadbeef0123456789abcdef\n</code></pre> <p>/var/piler/.mc/config.json:</p> <pre><code>{\"version\":\"10\", \"aliases\": {\"minio\": {\"url\":\"https://zzzzzzzzzzzzzzzzz.eu.r2.cloudflarestorage.com\",\"accessKey\":\"aabbaabbaabb\", \"secretKey\": \"deadbeef0123456789abcdef\", \"api\": \"S3v4\", \"path\": \"auto\"}}}\n</code></pre> <p>Then finally add the following to piler's crontab entries:</p> <pre><code>30 * * * * /usr/libexec/piler/s3-bucket-stat.sh minio\n</code></pre> <p>This will update the s3_bucket_stats table in the mysql piler database every hour. The result looks like the following. These details will be displayed at the tenant listing.</p> <pre><code>MariaDB [piler]&gt; select * from s3_bucket_stat;\n+---------+----------+---------+---------------------+\n| bucket  | size     | objects | t                   |\n+---------+----------+---------+---------------------+\n| fictive | 20481360 |    2978 | 2024-02-06 10:30:08 |\n+---------+----------+---------+---------------------+\n1 row in set (0.001 sec)\n</code></pre>"},{"location":"security/","title":"Securing the archive","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-23</p>"},{"location":"security/#single-node-layout","title":"Single node layout","text":"<p>The piler node should be accessed on port 443 from the Internet. Port 25 should be limited to your mail servers, also see the SMTP ACL feature below.</p>"},{"location":"security/#multiple-nodes-layout","title":"Multiple nodes layout","text":"<p>UI node ports accessibility:</p> <ul> <li>tcp/443: from the Internet</li> <li>tcp/3306: from the worker nodes</li> </ul> <p>The worker nodes ports accessibility:</p> <ul> <li>tcp/25: only the MX server</li> <li>tcp/80,443: only the UI node</li> <li>tcp/9312: only the UI node</li> </ul> <p>MX server ports accessibility:</p> <ul> <li>tcp/25: only from your mail servers</li> </ul> <p>It's also possible to use an internal network where the worker nodes' ports and the UI node mysql port are available.</p>"},{"location":"security/#starttls-support","title":"STARTTLS support","text":"<p>By default the installer creates a key and a self-signed certificate (/etc/piler/piler.pem) to support STARTTLS providing encrypted message transfer between the smtp client and the Piler smtp server. You are free to fix piler.pem to use your signed CA.</p>"},{"location":"security/#smtp-acl-lists","title":"SMTP ACL lists","text":"<p>Piler supports an smtp acl list similar to postscreen. See https://mailpiler.com/smtp-acl-list/ for more.</p>"},{"location":"security/#antivirus-and-antispam-support","title":"Antivirus and antispam support","text":"<p>Piler expects clean emails only. Spam and other malware occupy valuable disk space and other resources on the piler host, not to mention that it might pose other problems. So you should do the heavy lifting of scanning and filtering of any spam and malware on your MX servers.</p> <p>However, Piler is able to use the result of any antispam application, provided that it sets a specific email header to mark spam emails. If you used SpamAssassin, then you may use the following setting in /etc/piler/piler.conf, then piler can recognize when it receives a spam:</p> <pre><code>spam_header_line=X-Spam-Flag: YES\n</code></pre> <p>If piler recognizes a spam, then you may set an exlusion rule to discard it (preventing from getting to the archive) or archive it for a shorter time, eg. 30 days or so.</p> <p>Note that piler supports a single spam header line, ie. you cannot specify the anti-spam headers of several anti-spam products. However, by using an SMTP it\u2019s possible to rewrite several kind of antispam headers to a unified value. See https://mailpiler.com/consolidating-several-anti-spam-message-headers-on-the-smtp-gateway/ for more.</p>"},{"location":"setup/","title":"Installing piler enterprise edition","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-21</p>"},{"location":"setup/#installing-a-no-tenant-configuration-on-a-single-node-using-docker-compose","title":"Installing a no-tenant configuration on a single node using docker compose","text":"<p>There's a docker compose stack that deploys all the necessary components. Follow the instructions in the README.</p>"},{"location":"setup/#installing-a-no-tenant-configuration-on-a-single-linux-vm-node","title":"Installing a no-tenant configuration on a single Linux VM node","text":"<p>Pick the installer for either Ubuntu 24.04 LTS (noble.sh) or Centos/Redhat/Oracle 10 (centos10.sh). In this example we pick Ubuntu.</p> <p>Customise the following variables:</p> <ul> <li>PILER_HOSTNAME</li> <li>MYSQL_ROOT_PASSWORD</li> <li>MYSQL_PILER_PASSWORD</li> <li>ARCH (either \"amd64\" or \"arm64\")</li> </ul> <p>Execute the installer</p> <pre><code>curl -o noble.sh https://download.mailpiler.com/noble.sh\nchmod +x noble.sh\nsudo ./noble.sh\n</code></pre> <p>Copy both license files (piler.lic and license.jwt) to /etc/piler directory, then reboot the host, and verify that all services come up properly.</p>"},{"location":"setup/#centosredhatoracle-linux-specific-notes","title":"Centos/Redhat/Oracle Linux specific notes","text":"<p>SELinux is enabled by default. Please either disable it, or configure it properly.</p>"},{"location":"tuning/","title":"Tuning the archive","text":""},{"location":"tuning/#mysql","title":"Mysql","text":"<p>By default the installer sets modest buffer sizes. If you have +8 GB memory, try these settings:</p> <pre><code>[mysqld]\ninnodb_buffer_pool_size = 2.5G\ninnodb_buffer_pool_instances = 4\ninnodb_log_file_size = 512M\ninnodb_log_buffer_size = 128M\ninnodb_flush_log_at_trx_commit = 1\ninnodb_flush_neighbors = 0\ninnodb_file_per_table = 1\ninnodb_io_capacity = 800\ninnodb_io_capacity_max = 1600\ninnodb_read_io_threads = 4\ninnodb_write_io_threads = 4\n\nthread_handling = pool-of-threads\n\nmax_connections = 250\ntable_open_cache = 4000\nopen_files_limit = 65535\nskip_name_resolve = 1\n\ntmp_table_size = 128M\nmax_heap_table_size = 128M\naria_pagecache_buffer_size = 128M\n\nquery_cache_type = 0\nquery_cache_size = 0\nperformance_schema = OFF\n</code></pre> <p>Systemd overrides (/etc/systemd/system/mariadb.service.d/override.conf)</p> <pre><code>[Service]\nLimitNOFILE=65535\n</code></pre>"},{"location":"tuning/#linux-sysctl-tunings","title":"Linux sysctl tunings","text":"<pre><code># MariaDB + general DB workload tuning\nvm.swappiness = 1\nvm.dirty_background_ratio = 5\nvm.dirty_ratio = 15\nfs.file-max = 2097152\n\n# Networking\nnet.core.somaxconn = 65535\nnet.ipv4.tcp_fin_timeout = 10\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_keepalive_time = 300\nnet.ipv4.tcp_keepalive_intvl = 60\nnet.ipv4.tcp_keepalive_probes = 9\n</code></pre>"},{"location":"tuning/#manticore","title":"Manticore","text":"<p>Try these settings if you have +8 GB memory:</p> <pre><code>searchd {\n    ...\n    rt_mem_limit = 2G\n    workers = threads\n    dist_threads = 4\n    max_children = 30\n}\n</code></pre>"},{"location":"tuning/#piler","title":"Piler","text":"<p>The number of worker processes should be the number of cpu cores + 1, eg. for 2 CPUs: 3</p> <p>The piler-smtp daemon buffers the email to memory. The <code>max_message_size</code> variable determines the max message size that piler-smtp accepts. The <code>max_smtp_memory</code> variable caps the max allocatable memory that piler-smtp may claim. Be sure to set these to match your needs in /etc/piler/piler.conf:</p> <pre><code>max_message_size=50000000\nmax_smtp_memory=500000000\n# having 2 cpus\nnumber_of_worker_processes=3\n\n</code></pre>"},{"location":"upgrade/","title":"Upgrading","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-26</p> <p>The 2.x version ships a brand new web app that is not compatible with the old one, has a different configuration mechanism, and has a few prerequisites</p>"},{"location":"upgrade/#prerequisites","title":"Prerequisites","text":"<ul> <li>real time index</li> <li>dynamic indexes when using a multi-tenant deployment</li> </ul>"},{"location":"upgrade/#upgrade-steps","title":"Upgrade steps","text":"<p>...</p>"},{"location":"user-guide/","title":"End user guide to piler enterprise edition","text":"<p>This documentation applies to Piler enterprise edition 2.0.0</p> <p>Revision #1</p> <p>Publication date: 2025-SEP-26</p>"},{"location":"user-guide/#overview-of-how-piler-works","title":"Overview of how Piler works","text":"<p>Piler is a secure email archive that keeps your messages in a central repository. Piler archives every email it receives whether it be an incoming, outgoing or even an internal email.</p> <p>An important part of the archiving process is called indexing. It allows you to find the archived emails later based on search terms. Piler provides a web based UI that can be accessed using a web browser, eg. Firefox, Chrome, etc.</p> <p>The message indexing is close to real time. Messages appear in the search results within seconds.</p> <p>The archived messages are encrypted in a tamper-proof manner. When you click on a message you should see a green tick sign that means that the message retrieved from the archive is the same that was actually archived. Otherwise you may see a red failure sign.</p> <p>The UI has a built-in access control to prevent a user from accessing others' messages. However, users with an auditor role can see every archived email.</p> <p>The UI also creates an audit event each time a user performs an action, eg. enters a search query, downloads or restores a message, etc. Only auditors and administrators may search in the audit logs.</p>"},{"location":"user-guide/#login","title":"Login","text":"<p>Go to the archive URL, usually it\u2019s https://archive.example.com/</p> <p>The archive is usually configured to allow you to use your email address, and your email password as login credentials. In case of an issue, ask your IT for help. In some environments single sign-on (SSO) is set. In that case you don't type your credentials to the piler UI. When in doubt, ask your system administrators.</p> <p></p>"},{"location":"user-guide/#settings","title":"Settings","text":"<p>After logging in you may view and edit your settings, eg. page length, date format and timezone. To get to the settings menu, click on gear icon at the top right corner.</p> <p>You may turn on two-factor authentication as well. If you do so, be sure to write down the backup codes.</p> <p></p>"},{"location":"user-guide/#search-for-emails","title":"Search for emails","text":"<p>When you enter the archive the GUI presents you the last 20 archived messages. To have more hits per page, go to the \u201cSettings\u201d menu in the upper right corner of the screen.</p> <p>You may use two search interfaces: - Quick search in the long text input field - Advanced (or guided) search</p>"},{"location":"user-guide/#quick-search","title":"Quick search","text":"<p>This is the default and the preferred way of searching. Just enter the search terms, and you get the last 10000 hits in a paged view. If there are more than 10000 hits, then the exact number is shown between parentheses.</p> <p></p> <p>By default the UI applies the search criteria to each field. Eg. if you type mycompany, then it searches for emails having mycompany in the sender email address, in the subject and in the body.</p> <p>Note that piler indexes the textual data of the attachments as well. If the UI is instructed to search in the body, then it also searches in the attachments as well.</p> <p>The search is very intuitive. The UI guesses the format of the words you type. If you type 2018-01-31 (2018.01.31 is also a valid date) then it knows it's a date. If it has a @ sign, then it's an email address. Otherwise it's a subject or body expression.</p> <p>You may enter a finer search query by specifying keywords that precisely identify the type of the given search word.</p> Field Meaning from: Sender address to: Recipient address subject: Subject of the email body: Body of the email, including attachments date1: From (=not before) date (YYYY-MM-DD 00:00:00) date2: To (=not after) date (YYYY-MM-DD 23:59:59) size: Size of the message in bytes attachment: Attachment type. Possible values: word, excel, powerpoint, pdf, compressed, text, odf, image, audio, video, flash, other, any a: Same as attachment:"},{"location":"user-guide/#quick-search-examples","title":"Quick search examples","text":"<p>Emails from Gmail on 2018.02.28: <code>2018-02-28 @gmail.com</code></p> <p>Emails from Gmail before 2018.02.28 23:59:59: <code>date2: 2018-02-28, from: @gmail.com</code></p> <p>Emails from the Matrix (Both sender email addresses and names are indexed): <code>from: Agent Smith</code></p> <p>Emails to someone in Big company after 2018.01.31 00:00:00: <code>date1: 2018-01-31, to: @bigcompany.com</code></p> <p>Emails from jane@aaa.fu OR bill@aaa.fu in 2018 March having any kind of attachment: <code>date1:2018-03-01, date2:2018-03-31, from: jane@aaa.fu OR bill@aaa.fu a:any</code></p> <p>Emails from jane@aaa.fu OR bill@aaa.fu on 2018.02.15 having any kind of attachment: <code>date1:2018-02-15, date2:2018-02-15, from: jane@aaa.fu OR bill@aaa.fu a:any</code></p> <p>Emails on 2018.02.15 that both jane@aaa.fu AND bill@aaa.fu received having any kind of attachment: <code>date1:2018-02-15, date2:2018-02-15, to: jane@aaa.fu bill@aaa.fu a:any</code></p> <p>Viagra spam bigger than 200 kB spoofing my email address as the sender, and having 'order', then 'now' in the body: <code>size:&gt;.2M, subject: viagra OR cialis, body: order &lt;&lt; now, from: my@email.address</code></p> <p>Emails with the following expression: \u2018you have to know\u2019: <code>\u201cyou have to know\u201d</code></p> <p>Price list to jenny@aaa.fu, in pdf attachment(s) smaller than 150 kB: <code>size:&lt;150k, a: pdf, subject: price list, to: jenny@aaa.fu</code></p> <p>Price list to jenny@aaa.fu, in pdf attachment(s) not containing the word \u2018discount\u2019: <code>a: pdf, subject: price list !discount, to: jenny@aaa.fu</code></p> <p>Search using a wildcard for words like permission, permissions, permissing, etc. (Note that you need at least 5 characters before the * symbol): <code>permissi*</code></p> <p>See the following table on some additional search operators:</p> Expression Meaning cat dog Having cat and dog (order is not important) cat OR dog Having cat or dog cat dog \u201ccat dog\u201d Having the expression \u201ccat dog\u201d !dog Not having dog -dog Not having dog \u201ccat dog\u201d ~10 Proximity search cat &lt;&lt; dog Before operator: cat has to precede dog"},{"location":"user-guide/#advanced-or-guided-search","title":"Advanced (or guided) search","text":"<p>The other search interface is the advanced or guided search. It's a popup window you can get by clicking on either the down arrow in the right corner of the search field or the \u201cAdvanced search\u201d button.</p> <p></p> <p>The quick search and the advanced search are equivalent, they give you the same possibilities to define a search query. The advanced search presents you a list of separated input fields giving a better visual view where you can specify the same fields (From, To, dates, etc.) as with the quick search.</p>"},{"location":"user-guide/#recall-previous-search-queries","title":"Recall previous search queries","text":"<p>You may see a down arrow at the right side of the search field. Click on it to see your previous search queries, then select the search term you want to execute again.</p> <p></p>"},{"location":"user-guide/#save-a-search-query","title":"Save a search query","text":"<p>The UI lets you save then load search queries. It's especially handy if you entered a longer search expression or if you have to perform some regular searches. To save the current search query, click on the \u201cSave query\u201d button.</p>"},{"location":"user-guide/#execute-a-saved-search-criteria","title":"Execute a saved search criteria","text":"<p>Click on the \u201cLoad queries\u201d button to recall your saved searches, then click on the appropriate search criteria to execute it. You may remove a saved query by clicking on the red trash bin icon next to the search expression.</p> <p></p>"},{"location":"user-guide/#use-the-search-results","title":"Use the search results","text":"<p>If you have a search result then you can view any of the messages by clicking on it, eg. on the subject line. The message is shown in the preview pane to the right.</p> <p></p> <p>You don\u2019t have to open a message to view its contents. You may simply hover over the subject text in the search results list to see the first few hundred bytes of the message.</p>"},{"location":"user-guide/#tag-messages","title":"Tag messages","text":"<p>You may assign tags to selected emails. To do that perform a query providing the search results you want to tag, then select the appropriate messages you want to tag. Enter the tag name to the input field, and finally click on the tag icon.</p> <p></p> <p>Then you may use \u201ctag:mytag\u201d search query to recall such tagged messages.</p> <p>You may also remove assigned tags. To do that select the messages you want to un-tag. Click on the tag icon, leave the tag field empty, then click on the \"Tag\" button.</p>"},{"location":"user-guide/#add-notes-to-messages","title":"Add notes to messages","text":"<p>You may assign notes to individual messages. To do that select the given message, and type your notes on the preview window in the lower pane, then finally click on the \u201cSave\u201d button.</p> <p></p> <p>Then you may use the <code>note: keywords</code> to recall such a message, eg. <code>note: test note</code></p>"},{"location":"user-guide/#download-messages","title":"Download messages","text":"<p>You may download individual emails by clicking on the Download link or icon in the message preview pane. Click on the PDF icon to download the message as a PDF file.</p> <p>It's also possible to download the search results from the current page as a zip file. To do so, select some or all messages in the upper search results window, then click on the download icon.</p> <p></p>"},{"location":"user-guide/#restore-messages","title":"Restore messages","text":"<p>You may restore a single message by clicking the message, and then on the restore button or link in the preview pane. The message is restored to your mailbox.</p> <p>Just as with the download feature, you may also restore several messages at a time. Select the messages you want to restore, then click on the right arrow icon on the top left icon bar.</p> <p></p>"},{"location":"user-guide/#exporting-messages-from-the-ui","title":"Exporting messages from the UI","text":"<p>You may download 20-100 emails from the UI at the same time by selecting them. What if you entered a search query, and it produced 5000 hits, and you need all of them?</p> <p>If the archive administrators enabled the export feature, you may click on the save icon (it looks like a floppy disc) in the top left icon bar to initiate a background process that exports all emails matching the search query.</p> <p>Then click on the \"Exports\" button, and you may download a zip file containing the emails. Be sure to click on the \"Remove\" link after you downloaded the zip file.</p> <p></p>"}]}